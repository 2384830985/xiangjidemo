<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>区间demo</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>
<div class="">复印价格</div>
<input type="file" name="upload" accept="image/png,image/jpeg,image/gif">
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<div>1234</div>
<input type="file" capture="camera" accept="image/*" id="cameraInput" name="cameraInput"/>
<div id="demo">
</div>
<button id="submit">提交</button>

<script>
    // 默认
    var arr = [
        {"startPage":"1", "endPage":"9","unitPrice":10}, // 90
        {"startPage":"10", "endPage":"20","unitPrice":8},// 88
        {"startPage":"21", "endPage":"30","unitPrice":6},// 60
        {"startPage":"31", "endPage":"40","unitPrice":5},// 50
        {"startPage":"41", "endPage":"50","unitPrice":3},// 30
        {"startPage":"51", "endPage":"60","unitPrice":2},// 20
        {"startPage":"61", "endPage":"n","unitPrice":1} // 40
        ];
    function sizePrice(data,num) {
        let price = 0;
        for (var i=data.length-1;i>=0;i--){
            console.log(i)
            if (data[i].endPage!=='n'){ // 不是最后一行
                if (num>data[i].endPage) {// 大于当前价位的时候
                    price += (Number(data[i].endPage)-Number(data[i].startPage)+1)*(data[i].unitPrice*100)
                    console.log(price)
                }else if (num>=data[i].startPage&&num<=data[i].endPage){ // 在区间内
                    price += (num-Number(data[i].startPage)+1)*(data[i].unitPrice*100)
                    console.log(price)
                }
            }else { // 最后一行
                if (num>=data[i].startPage) {
                    price += (num-Number(data[i].startPage)+1)*(data[i].unitPrice*100)
                    console.log(price)
                }
            }
        }
        console.log(price/100)
    }
    sizePrice(arr,4)
    // 初试话数据
    function init() {
        var html = '';
        for (var i=0; i<arr.length;i++){
            html +=
                '<div class="initStartPage">' +
                '<input type="text" placeholder="复印开始页数" disabled class="startPage" value="'+arr[i].startPage+'">=';
            // 等于最后一个的时候值为n并且不可以
            if (arr.length-1===i) {
                html +=
                    '<input type="text" placeholder="复印结束页数" ' +
                    'class=endPage' +
                    ' data-index="'+(i+1)+'"' +
                    ' disabled value="n">='
            }else { //不是最后一个可以使用
                html +=
                    '<input type="text" placeholder="复印结束页数" ' +
                    'class=endPage' +
                    ' data-index="'+(i+1)+'"' +
                    '  value="'+arr[i].endPage+'">='
            }
            html +=
                '<input type="text" placeholder="复印价格" class="unitPrice" value="0">' +
                '</div>';
            if (arr.length-1===i) { //最后一个有增加删除按钮
                html += '<button id="addPage">增加</button><button id="deletePage">删除</button>'
            }
        }
        $('#demo').html(html)
        endPageChange()
    }
    init();
    // 添加事件
    function endPageChange (){
        // 改变事件
        $('.endPage').change(function(){
            var index= $(this).data('index');
            console.log(index);
            console.log($(this).data('index'))
            console.log($(this).index())
            console.log($(this).context.value)
            if (Number($(this).context.value)<arr[index-1].startPage){
               alert('当前修改页数应大于开始页数量')
            }else {
                arr[index-1].endPage = Number($(this).context.value);
                arr[index].startPage = Number($(this).context.value)+1;
                init();
            }
        });
        // 添加
        $('#addPage').click(function () {
            arr[arr.length-1].endPage = Number(arr[arr.length-1].startPage)+1;
            arr.push(
                {"startPage": Number(arr[arr.length-1].startPage)+2, "endPage":"n","unitPrice": 0}
            );
            init();
        })
        // 删除
        $('#deletePage').click(function () {
            if (arr.length>2) {
                arr[arr.length-1].endPage = 'n';
                arr.splice(arr.length-1,1);
                init();
            }

        })
    }
    $('#submit').click(function () {
        var submitValue = [];
        // console.log($('.initStartPage').length);
        var dom = document.getElementsByClassName('initStartPage');
        for (var i=0;i<dom.length;i++) {
            if (i!==0){
                console.log(dom[i].children[0].value)
                console.log(submitValue[i-1].endPage)
                if (dom[i].children[0].value<submitValue[i-1].endPage||dom[i].children[0].value===submitValue[i-1].endPage) {
                    alert('请检查页数，页数格式不正确');
                    break;
                }
            }
            submitValue.push(
                {
                    startPage: dom[i].children[0].value,
                    endPage: dom[i].children[1].value,
                    unitPrice: dom[i].children[2].value
                }
            );

        }
        console.log(submitValue)
    })
    

</script>
</body>
</html>